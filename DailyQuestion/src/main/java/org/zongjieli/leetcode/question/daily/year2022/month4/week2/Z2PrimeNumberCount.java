package org.zongjieli.leetcode.question.daily.year2022.month4.week2;

import java.util.Arrays;

/**
 * 给定两个整数 left 和 right
 * 在闭区间 [left, right] 范围内
 * 统计并返回计算置位位数为质数的整数个数
 * 计算置位位数就是二进制表示中 1 的个数
 * 例如,21 的二进制表示 10101 有 3 个计算置位
 *
 * 1 <= left <= right <= 10^6
 * 0 <= right - left <= 10^4
 *
 * @author   Li.zongjie
 * @date     2022/4/7
 * @version  1.0
 */
public class Z2PrimeNumberCount {

    private int[][] bitAdd = new int[][]{
            {0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1},
            {0, 1, 2, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1},
            {1, 3, 3, 2, 2, 2, 2, 1, 0, 1, 2, 2, 2, 1, 0, 1, 2, 2, 2, 1},
            {4, 6, 5, 4, 4, 4, 3, 1, 1, 3, 4, 4, 3, 1, 1, 3, 4, 4, 3, 1},
            {10, 11, 9, 8, 8, 7, 4, 2, 4, 7, 8, 7, 4, 2, 4, 7, 8, 7, 4, 1},
            {21, 20, 17, 16, 15, 11, 6, 6, 11, 15, 15, 11, 6, 6, 11, 15, 15, 11, 5, 1},
            {41, 37, 33, 31, 26, 17, 12, 17, 26, 30, 26, 17, 12, 17, 26, 30, 26, 16, 6, 1},
            {78, 70, 64, 57, 43, 29, 29, 43, 56, 56, 43, 29, 29, 43, 56, 56, 42, 22, 7, 1},
            {148, 134, 121, 100, 72, 58, 72, 99, 112, 99, 72, 58, 72, 99, 112, 98, 64, 29, 8, 1},
            {282, 255, 221, 172, 130, 130, 171, 211, 211, 171, 130, 130, 171, 211, 210, 162, 93, 37, 9, 1},
            {537, 476, 393, 302, 260, 301, 382, 422, 382, 301, 260, 301, 382, 421, 372, 255, 130, 46, 10, 1},
            {1013, 869, 695, 562, 561, 683, 804, 804, 683, 561, 561, 683, 803, 793, 627, 385, 176, 56, 11, 1},
            {1882, 1564, 1257, 1123, 1244, 1487, 1608, 1487, 1244, 1122, 1244, 1486, 1596, 1420, 1012, 561, 232, 67, 12, 1},
            {3446, 2821, 2380, 2367, 2731, 3095, 3095, 2731, 2366, 2366, 2730, 3082, 3016, 2432, 1573, 793, 299, 79, 13, 1},
            {6267, 5201, 4747, 5098, 5826, 6190, 5826, 5097, 4732, 5096, 5812, 6098, 5448, 4005, 2366, 1092, 378, 92, 14, 1},
            {11468, 9948, 9845, 10924, 12016, 12016, 10923, 9829, 9828, 10908, 11910, 11546, 9453, 6371, 3458, 1470, 470, 106, 15, 1},
            {21416, 19793, 20769, 22940, 24032, 22939, 20752, 19657, 20736, 22818, 23456, 20999, 15824, 9829, 4928, 1940, 576, 121, 16, 1},
            {41209, 40562, 43709, 46972, 46971, 43691, 40409, 40393, 43554, 46274, 44455, 36823, 25653, 14757, 6868, 2516, 697, 137, 17, 1},
            {81771, 84271, 90681, 93943, 90662, 84100, 80802, 83947, 89828, 90729, 81278, 62476, 40410, 21625, 9384, 3213, 834, 154, 18, 1},
            {166042, 174952, 184624, 184605, 174762, 164902, 164749, 173775, 180557, 172007, 143754, 102886, 62035, 31009, 12597, 4047, 988, 172, 19, 1},
            {340994, 359576, 369229, 359367, 339664, 329651, 338524, 354332, 352564, 315761, 246640, 164921, 93044, 43606, 16644, 5035, 1160, 191, 20, 1}
    };

    public int countPrimeSetBits(int left, int right) {
        return countPrimeSetBit(right) -  countPrimeSetBit(left - 1);
    }

    public int countPrimeSetBit(int n) {
        int result = 0;
        int bitCount = 0, bitCalculate = n;
        while ((bitCalculate >>= 1) > 0) {
            bitCount++;
        }
        int bitCompare = 1 << bitCount;
        int add = 0;
        while (bitCompare > 0) {
            if ((n & bitCompare) > 0) {
                result += bitAdd[bitCount][add++];
            }
            bitCompare >>= 1;
            bitCount--;
        }
        return result + bitAdd[0][add];
    }

    public static void main(String[] args) {
        Z2PrimeNumberCount test = new Z2PrimeNumberCount();
        // 4
        System.out.println(test.countPrimeSetBits(6, 10));
        // 117
        System.out.println(test.countPrimeSetBits(8, 200));
        // 1465
        System.out.println(test.countPrimeSetBits(289051, 294301));
    }
}
